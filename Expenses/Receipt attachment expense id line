--------------------------ReceiptAttach--------------------------------------------
SELECT
  ENTITY_NAME
, PK1_VALUE
, TITLE
, RECEIPT_LINK
, RECEIPT_DATE
, DISPLAY_IMG
, EXT
, ORDER1
FROM (
SELECT 
  FAD.ENTITY_NAME
, to_number(PK1_VALUE)  PK1_VALUE
, FDT.DM_VERSION_NUMBER
, FDT.TITLE
, 'https://'||(SELECT DISTINCT POD.EXTERNAL_VIRTUAL_HOST FROM ASK_DEPLOYED_DOMAINS POD WHERE POD.DEPLOYED_DOMAIN_NAME='FADomain')||'/cs/idcplg?IdcService=GET_FILE&dID='||FDT.DM_VERSION_NUMBER Receipt_Link
, FAD.CREATION_DATE RECEIPT_DATE
, EET.NAME 
, EE.DESCRIPTION
, EE.RECEIPT_AMOUNT
, EE.MERCHANT_NAME
, EE.START_DATE
, ATT.DWEBEXTENSION EXT
, CASE WHEN ATT.DWEBEXTENSION IN ('emf','wmf','jpg','jpeg','jfif','jpe','png','bmp','dib','rle','gif','emz','wmz','tif','tiff','svg','ico','webp') THEN 'Y' ELSE 'N' END DISPLAY_IMG
, 2 ORDER1
FROM FND_ATTACHED_DOCUMENTS FAD
LEFT JOIN FND_DOCUMENTS     FD  ON (FAD.DOCUMENT_ID = FD.DOCUMENT_ID AND FAD.ENTERPRISE_ID = FD.ENTERPRISE_ID)
LEFT JOIN FND_DOCUMENTS_TL  FDT ON (FAD.DOCUMENT_ID = FDT.DOCUMENT_ID AND 'US'=FDT.LANGUAGE AND FAD.ENTERPRISE_ID=FDT.ENTERPRISE_ID)
JOIN EXM_EXPENSES           EE  ON (TO_CHAR(FAD.PK1_VALUE)=TO_CHAR(EE.EXPENSE_ID) )
LEFT JOIN EXM_EXPENSE_TYPES EET ON EET.EXPENSE_TYPE_ID=EE.EXPENSE_TYPE_ID
LEFT JOIN FUSION_OCSERVER11G.Revisions ATT ON (FDT.DM_VERSION_NUMBER=ATT.DID)
WHERE 1=1
AND FAD.ENTITY_NAME = 'EXM_EXPENSES'
AND UPPER(EE.EXPENSE_ID) = UPPER(:BINDEXPENSEID)
)


ORDER BY ORDER1,RECEIPT_DATE DESC, PK1_VALUE DESC